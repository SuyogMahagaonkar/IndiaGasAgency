<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <title>Dashboard</title>
	   <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    
<link rel="stylesheet" th:href="@{../css/logo.css}">
	    <link rel="stylesheet" th:href="@{../css/logoname.css}">
	    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
	    <!-- Latest compiled and minified JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<!-- Optional theme -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
		<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
		<link rel="stylesheet" th:href="@{../css/popup.css}">
	<style>
		body{
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
			background-color: #0e2433;
			color: #fff;
		}
		header{
			background-color: #45b6fe;
			color: white;
			padding: 10px;
			text-align: center;
		}
		section{
			padding: 20px;
		}
		
	</style>
	
	</head>
	<body>
		<header>
			
			<h1>Welcome, [[${user.getName()}]]</h1>
			<span sec:authorize="isAuthenticated">
				<a th:href="@{/logout}">
					Logout					 
				</a>
			</span>
		</header>
		<section class="content-header" th:replace="common/navbar::breadcrumbfragment"></section>
		<section>
			
			<h2>You Can Book Cylinder Here......</h2>
			
		</section>
		<div class="container">
	<div  class="alert alert-success alert-dismissible fade show" role="alert" th:if="${message != null}">
				[[${message}]]
				
			</div>
			
        <div class="left-section"></div>
        <div class="right-section">
			
            <div class="booking-container">
                <form class="booking-form"
			th:action="@{/user-page}" 
			method="post"
			role="form"
			th:object="${booking}">
                    <h2 class="booking-title"><i class="fas fa-user-circle"></i> Book a cylinder</h2>
                    <br>
                    
                       <i class="fas fa-user icon" ></i> 
                       <label for="booking_date">Select Date :</label>
				<input type="date"  class="form-control" id="booking_date" name="booking_date"  required>
				
			<br><div th:if="${preBookingDate != null}">	
			 <label for="pre_booking_date">Your Previous Date :</label>
				<input type="date" th:value="${preBookingDate}" class="form-control" id="pre_booking_date" name="booking_date"  disabled>
				</div><br>
                       <i class="fas fa-user icon" ></i> 
                       <label for="category">Category</label>
                       <select class="form-control" id="category" name="category" required>
					      <option value="HP">HP</option>
					      <option value="Indane">Indane</option>
					      <option value="Shell">Shell</option>
					      
					    </select>
					<br><br>                                       
                    <a class="btn btn-success" onclick="myFunction()" id="openModalBtn">Book</a><br>    
                     <!-- The Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span id="closeModalBtn" class="close">&times;</span>
            <center><strong><h3 id="dif">Order Details</h3></strong> </center>
            <div class="container" id="select_date_first_container">
<table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>#</th>
                            <th class="text-center">Price</th>
                            <th class="text-center">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="col-md-5" ><em id="gas_name"></em></h4></td>
                            <td class="col-md-1" style="text-align: center">1 </td>
                            <td class="col-md-4 text-center">&#8377; 1000</td>
                            <td class="col-md-2 text-center">&#8377; 1000</td>
                        </tr>
                       <br><br>
                        <tr>
                            <td>   </td>
                            <td>   </td>
                            <td class="text-right">
								 <p>
                                <strong>Payment Type: </strong>
                            </p>
                            
                            <p th:if="${preBookingDate != null}">
                                <strong id="taxlbl">Fine *: </strong>
                            </p></td>
                            <td class="text-center">
								<p>
                                <p>Cash</p>
                            </p>
                            
                            
                            <p th:if="${preBookingDate != null}">
                                <strong id="tax"></strong>
                            </p></td>
                        </tr>
                        <tr>
                            <td>   </td>
                            <td>   </td>
                            <td class="text-right"><h4><strong>Total: </strong></h4></td>
                            <td class="text-center text-danger"><h4><strong id="total_price">&#8377; 1000</strong></h4></td>
                        </tr>
                        
                    </tbody>
                </table>
                <p id="msg" style="font-size: smaller;">
							
						</p>
</div>
  <br><button class="btn btn-outline-success" type="submit" >Pay</button>
            
        </div>
    </div>             
                </form>
            </div>
        </div>
    </div>
	

</div>
		<script>let openModalBtn = document.getElementById("openModalBtn");
let modal = document.getElementById("myModal");
let closeModalBtn = document.getElementById("closeModalBtn");

openModalBtn.addEventListener("click", function() {
    modal.style.display = "block";
    
});

closeModalBtn.addEventListener("click", function() {
    modal.style.display = "none";
});

window.addEventListener("click", function(event) {
    if (event.target === modal) {
        modal.style.display = "none";
    }
});
function myFunction() { 
 let gas_name=document.getElementById("category").value;
 document.getElementById("gas_name").innerHTML=gas_name+" Gas Cylinder";
 let previous_date = new Date(document.getElementById("pre_booking_date").value);
let Current_date = new Date(document.getElementById("booking_date").value);
console.log(Current_date);
if(isNaN(Current_date)){
	document.getElementById("dif").innerHTML= "";
	document.getElementById("select_date_first_container").innerHTML="<h3>PLEASE SELECT DATE FIRST...</h3>";
	document.getElementById("paybtn").style.display = "none";

}
else{
	let diffTime = Math.abs(Current_date - previous_date);
let diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
console.log(diffTime + " milliseconds");
let price=0;
let total_price=0;
if(diffDays<=30 && diffDays>=0 ){
	price=500;
	 total_price=1500;
	 document.getElementById("msg").innerHTML="*your selected date is within 30 days of previous date";
	 document.getElementById("tax").innerHTML="&#8377; "+price;
	 document.getElementById("taxlbl").innerHTML="* Fine:";
	 document.getElementById("total_price").innerHTML="&#8377; "+total_price;
	}
else if(diffDays>30 || (diffDays<0 && diffDays>-30)) {
				
				price=0;
				total_price=1000;
				 document.getElementById("msg").innerHTML="";
				 document.getElementById("tax").innerHTML="";
				 document.getElementById("taxlbl").innerHTML="";
				 document.getElementById("total_price").innerHTML="&#8377; "+total_price;
			}
document.getElementById("total_price").innerHTML="&#8377; "+total_price;

console.log(diffDays + " days");
}


 }
</script>
	</body>